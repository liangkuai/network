# 数字证书（Digital Certificate）

又称公开密钥认证（Public Key Certificate）。

简单来说就是，**由 CA 签发，经过 CA 数字签名的包含公钥、公钥拥有者信息的文件，用来证明这个公钥是谁的。**

#### 1. 数字证书里面有什么信息？

- **公钥**（核心内容）
- 公钥拥有者的信息（属于谁的）
- 证书颁发机构的信息（谁发的）
- 签名使用的哈希算法
- 其他信息
- **数字签名**

#### 2. 如何生成数字证书？

1. 使用哈希算法对「证书基本信息」进行计算，得到「摘要」；
2. 使用 CA 的私钥对「摘要」进行加密，得到「数字签名」；
3. 「证书基本信息」加上「数字签名」，组成「数字证书」。

#### 3. 如何验证证书里，由 CA 生成的数字签名？  
数字证书的验签操作需要签名方的公钥，而 CA 的公钥一般都是操作系统内置。

#### 4. 数字证书解决了什么问题？
总的来说，数字证书的作用就是解决「公钥信任问题」。

- 使用数字签名防止篡改，确保公钥的安全传输。
- 证明公钥拥有者的身份，拥有证书的人就是公钥真正的拥有者。

比如：

- 在数字签名的使用场景下，接收方验证数字签名需要签名方的公钥。
- 在 HTTPS 协议中，客户端获取服务端公钥是安全通信的第一步。

而公钥在网络传输中存在安全问题（篡改、伪装），使用数字证书就可以解决这些问题。

#### 5. 数字签名和数字证书的区别
两者的认证过程是一样的，但是传输的目的对象不一样。数字签名用来传输信息；而数字证书只是为了安全传输发送方的公钥。


## CA

#### 1. 什么是 CA？
Certificate Authority，数字证书颁发机构。**负责签发证书、认证证书、管理已颁发证书的权威机构。**

知名的 CA 全世界就那么几家，比如 DigiCert、VeriSign、Entrust、Let’s Encrypt 等，它们签发的证书分 DV、OV、EV 三种，区别在于可信程度。

DV 是最低的，只是域名级别的可信，背后是谁不知道。EV 是最高的，经过了法律和审计的严格核查，可以证明网站拥有者的身份（在浏览器地址栏会显示出公司的名字，例如 Apple、GitHub 的网站）。

#### 2. 信任链
我们知道数字证书由 CA 创建并签署，但很少有组织从事这项工作。如果他们正在为所有服务器签署证书，则必须为所有签名使用相同的私钥，如果它被盗，那么所有的信任都会丢失。为了解决这个问题并增加更多的平均信息量，引入了中间 CA（intermediate CA）。

intermediate CA 是 Root CA 信任的证书颁发机构，还具有由 Root CA 签名的证书。这样两个 CA 就这形成了信任链，证书对应形成了证书链。

#### 3. intermediate CA 证书使用过程
客户端在与使用 intermediate CA 颁发的证书的服务端通信时，服务端将返回证书链（除了根证书）

- 证书 1：intermediate CA 颁发的证书
- 证书 2：Root CA 颁发给 intermediate CA 的证书

客户端先使用本地根证书的公钥验证证书 2，确认此 intermediate CA 是否可信；然后再使用证书 2 中的公钥验证证书 1，最后获取证书 1 中的服务端公钥。

